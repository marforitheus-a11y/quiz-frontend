<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Concursando - Login</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="login-container" role="main">
    <div class="logo logo-header" role="img" aria-label="Concursando">
      <!-- Layered inline SVG (tintable via CSS) -->
      <svg class="logo-svg" viewBox="167.936 366.592 239.61599999999999 272.384" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">
        <path d="M252.561 404.612C260.671 403.105 309.796 403.642 318.167 405.121C326.116 406.525 333.787 409.536 340.771 413.554C360 424.615 371.227 442.02 376.957 463.012L309.489 462.933C297.651 462.927 285.064 462.082 273.318 463.458C268.543 464.017 263.696 465.234 259.391 467.418C253.033 470.644 248.436 477.332 246.332 484.023C243.469 493.13 242.147 550.12 246.135 557.635C255.749 559.204 267.366 558.248 277.135 558.021C287.618 557.778 301.068 556.588 309.311 549.37C312.887 546.237 315.531 541.861 318.901 538.479C324.875 532.482 358.579 535.092 367.687 535.149L376.932 535.226C377.618 553.713 376.792 570.978 365.329 586.524C355.734 599.537 341.634 608.761 325.521 611.057C315.102 612.542 303.831 611.572 293.298 611.601C264.768 611.677 237.204 614.253 212.928 595.952C196.31 583.424 185.837 564.539 183.01 544.001C181.522 533.195 182.066 522.095 182.028 511.208C181.932 483.427 180.638 459.059 198.609 435.574C212.2 417.815 230.444 407.528 252.561 404.612Z" fill="currentColor"/>
        <!-- truncated for brevity in file; remaining paths retained -->
      </svg>
      <h1 class="brand-title">Concursando</h1>
      <p class="muted">Sua plataforma de questões por IA</p>
    </div>

    <!-- Simplified login form: only username + password (signup removed) -->
    <form id="auth-form">
      <input type="text" id="username" placeholder="Seu usuário ou e-mail" required>

      <input type="password" id="password" placeholder="Senha" required>

      <a href="#" class="forgot">Esqueceu a senha?</a>

      <button type="submit" id="submit-btn" class="login-btn">Entrar</button>
    </form>

    <p id="error-message" class="error-message"></p>
  </div>

    <!-- deploy-bump: updated login handler to use real backend auth -->
  </body>

  <script>
    // Real login handler: POST to backend /login and store JWT.
    (function () {
      const API_URL = 'https://quiz-api-z4ri.onrender.com';

      document.addEventListener('DOMContentLoaded', () => {
        const authForm = document.getElementById('auth-form');
        const errorMessage = document.getElementById('error-message');
        if (!authForm) return;

        authForm.addEventListener('submit', async (e) => {
          e.preventDefault();
          if (errorMessage) { errorMessage.textContent = ''; errorMessage.style.color = 'orange'; errorMessage.textContent = 'Entrando...'; }

          const loginIdentifier = document.getElementById('username').value.trim();
          const password = document.getElementById('password').value;

          if (!loginIdentifier || !password) {
            if (errorMessage) { errorMessage.textContent = 'Por favor preencha usuário e senha.'; errorMessage.style.color = 'red'; }
            return;
          }

          try {
            const resp = await fetch(`${API_URL}/login`, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ loginIdentifier, password })
            });
            const data = await resp.json();
            if (!resp.ok) throw new Error(data.message || `Erro ${resp.status}`);

            // store token and username
            localStorage.setItem('token', data.token);
            try {
              const payload = JSON.parse(atob(data.token.split('.')[1].replace(/-/g, '+').replace(/_/g, '/')));
              localStorage.setItem('username', payload.username || loginIdentifier);
              if (payload.role === 'admin') window.location.href = 'admin.html';
              else window.location.href = 'quiz.html';
            } catch (err) {
              // fallback redirect
              window.location.href = 'quiz.html';
            }

          } catch (err) {
            if (errorMessage) { errorMessage.textContent = err.message || 'Usuário ou senha inválidos.'; errorMessage.style.color = 'red'; }
          }
        });
      });
    })();
  </script>

</body>
</html>